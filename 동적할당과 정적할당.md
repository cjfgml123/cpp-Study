### 동적할당과 정적할당



#### 1.  정적/동적 구분 기준

- 프로그램 실행 중에 메모리 공간을 할당하는가? 이다. 정적할당(Static)은 컴파일 단계에서 필요한 메모리 공간을 할당하고 동적할당은 실행 단계에서 공간을 할당해주는 것이다.



#### 2. 메모리 영역

- 활용과 기능에 따라 크게 4가지 종류로 구분된다.

크게 정적, 동적 메모리로 나뉘고 

정적 메모리 : Code(함수, 상수 저장) ,Data(전역/정적 변수 저장)

동적 메모리 : Stack(지역/매개 변수 저장),Heap(동적 할당 영역)



##### 1) Code 영역

- 함수와 상수, 실행한 프로그램의 코드가 저장되는 공간이다. 함수나 상수는 컴파일 단계에서 검사를 마치고 저장되므로 이 곳은 정적 메모리다.

##### 2) Data 영역

- 전역 변수와 정적(Static) 변수가 저장되는 영역이다. Code영역과 마찬가지로 컴파일 단계에서 검사를 끝마치고 메모리 할당이 이루어진다.

##### 3) Stack 영역

- 지역 변수와 매개 변수가 저장되는 곳이다. 통상적으로 우리가 변수라고 부르는 것들을 선언하면 이 영역에서 공간을 할당해준다. 지역변수와 매개변수는 선언된 함수 내에서만 사용 가능하므로 그 함수를 벗어나면 할당된 공간을 반납하고 사라져야 한다. 프로그램 실행 과정에서 이런 일은 함수 하나가 사라질 때마다 빈번하게 일어난다.

##### 4) Heap 영역

- 동적 할당을 받아오는 장소, 동적 할당 받은 공간은 우리가 별도의 명령어(ex C라면 free(),C++은 delete())를 이용해 해제해주기 전까지는 사라지지 않는다. 동적 할당은 프로그램 실행 중에 발생하므로 Heap은 동적 메모리다.



#### 3. 메모리 구분 주의할 점

- 메모리에서 동적/정적 영역을 구분하는 것과 각 변수들의 동적/정적 할당은 별개다. 헷갈림 주의해야 함. 지역 변수나 매개 변수는 컴파일 단계에서 메모리 공간을 할당받으니 정적 할당이지만, 정작 할당받는 메모리 공간은 동적 영역인 Stack이다. 컴파일 단계에서 공간을 할당 받으니 실행 단계에서는 공간의 크기를 조절할 수 없지만, Stack 영역은 동적 영역이기 때문에 실행 중 얼마든지 해제할 수 있는 것이다.



#### 4. 정적 할당

- 컴파일 단계에서 메모리 공간을 할당 받는 것. ex) 변수나 배열을 선언하는 것을 들 수 있다. 한번 컴파일을 시작하면 그때부터는 더 이상 추가적으로 변수나 배열을 선언할 수 없다.

전역 변수와 정적 변수는 Data 영역에 , 지역 / 매개 변수는 Stack 영역에 각각 할당 받을때 매개변수를 갖고 있는 함수가 종료되면 Stack에 있던 매개변수가 사라진다. 이처럼 정적 할당은 컴파일 단계에서 변수에 메모리 공간을 제공해주고, 해당 함수 혹은 프로그램이 종료될 때 반납한다.

##### 장점 : 

- 메모리 누수 걱정x, 일단 컴파일해서 메모리 공간을 할당 받으면 실행단계에서 할당이 해제되는 일은 없고 몸 담고 있는 함수가 사라지면 운영체제가 알아서 해당 메모리 공간을 회수해간다. 대출만 하면 반납은 자동으로 되는 것.

- ##### 단점 : 

  - 할당받는 메모리 공간의 크기가 정해져 있어 프로그램이 실행될 때 수정할 수 없다.  ex) int면 4byte, double 이면 8byte , 이 때문에 메모리 공간의 낭비가 발생할 수 있다. 처음에는 100만큼의 공간이 필요한데 나중에는 8만 필요한 상황이 있을때 정적할당은 무조건 100만큼의 공간을 받는다. 8만 필요하면 나머지 92는 아무것도 안한다.



#### 5.동적 할당

- 실행 단계에서 메모리 공간을 할당받는 것이다. 직접 Stack 영역까지 가서 메모리 공간을 빌리는 정적 할당과 달리 포인터를 사용해서 Heap영역을 가리켜 해당 공간을 할당한다.

C : malloc(). free() / C++ : new, delete()



##### 장점 : 

- 언제나 원하는 만큼의 메모리가 맞춤으로 할당된다. 실행 단계에서 메모리 공간을 할당받고 해제하니 경제적이다.

##### 단점 :

- 더 이상 사용하지 않는 공간을 사용자가 직접 해제해주어야 한다. 대출을 했다면 반납도 직접해야 하듯이
- 만약 사용하지 않는 메모리를 제때 반납하지 않으면 메모리 누수가 발생할 수 있다. 쓰지도 않는 공간을 가지고 있으니 정작 필요할 때 메모리가 부족해질 수 있다.

















